# 综合布线记录管理系统 - 系统结构设计

## 1. 技术栈

### 1.1 前端
- Vue 3
- TypeScript
- Element Plus（UI组件库）
- Vue Router（路由管理）
- Axios（HTTP请求）
- Vite（构建工具）

### 1.2 后端
- Node.js
- TypeScript
- Express（Web框架）
- better-sqlite3（SQLite数据库）
- multer（文件上传）
- xlsx（Excel解析）
- cors（跨域处理）

### 1.3 数据库
- SQLite

---

## 2. 项目目录结构

```
综合布线记录管理系统/
├── backend/                    # 后端代码
│   ├── src/
│   │   ├── config/            # 配置文件
│   │   │   └── database.ts    # 数据库配置
│   │   ├── controllers/        # 控制器
│   │   │   ├── record.controller.ts
│   │   │   └── upload.controller.ts
│   │   ├── models/            # 数据模型
│   │   │   └── record.model.ts
│   │   ├── routes/            # 路由
│   │   │   ├── index.ts
│   │   │   ├── record.routes.ts
│   │   │   └── upload.routes.ts
│   │   ├── services/          # 业务逻辑
│   │   │   ├── record.service.ts
│   │   │   └── upload.service.ts
│   │   ├── utils/             # 工具函数
│   │   │   └── excel.parser.ts
│   │   ├── app.ts             # Express应用配置
│   │   └── server.ts          # 服务器入口
│   ├── uploads/               # 上传文件目录
│   ├── data/                  # 数据库文件目录
│   ├── package.json
│   ├── tsconfig.json
│   └── .env                  # 环境变量
├── frontend/                  # 前端代码
│   ├── src/
│   │   ├── assets/           # 静态资源
│   │   ├── components/       # 组件
│   │   │   ├── RecordList.vue
│   │   │   ├── UploadFile.vue
│   │   │   ├── ParseResult.vue
│   │   │   └── RecordDetail.vue
│   │   ├── router/           # 路由
│   │   │   └── index.ts
│   │   ├── services/         # API服务
│   │   │   └── api.ts
│   │   ├── types/            # TypeScript类型定义
│   │   │   └── index.ts
│   │   ├── utils/            # 工具函数
│   │   ├── App.vue
│   │   └── main.ts
│   ├── public/
│   ├── index.html
│   ├── package.json
│   ├── tsconfig.json
│   └── vite.config.ts
├── README.md
└── .gitignore
```

---

## 3. 数据库设计

### 3.1 数据库表：records

```sql
CREATE TABLE records (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    record_number TEXT NOT NULL,           -- 登记表编号
    datacenter_name TEXT NOT NULL,         -- 机房名称
    idc_requirement_number TEXT,          -- IDC需求编号
    yes_ticket_number TEXT,                -- YES工单编号
    user_unit TEXT,                        -- 用户单位
    cable_type TEXT,                       -- 线缆类型
    operator TEXT,                         -- 运营商
    circuit_number TEXT,                   -- 线路编号
    contact_person TEXT,                   -- 报障人/联系方式
    start_port TEXT,                       -- 起始端口（A端）
    hop1 TEXT,                            -- 一跳
    hop2 TEXT,                            -- 二跳
    hop3 TEXT,                            -- 三跳
    hop4 TEXT,                            -- 四跳
    hop5 TEXT,                            -- 五跳
    end_port TEXT,                         -- 目标端口（Z端）
    user_cabinet TEXT,                     -- 用户机柜
    label_complete INTEGER DEFAULT 0,       -- 线路标签是否齐全 (0:否, 1:是)
    cable_standard INTEGER DEFAULT 0,         -- 线路是否规范 (0:否, 1:是)
    remark TEXT,                           -- 备注
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_datacenter_name ON records(datacenter_name);
CREATE INDEX idx_record_number ON records(record_number);
CREATE INDEX idx_circuit_number ON records(circuit_number);
CREATE INDEX idx_start_port ON records(start_port);
CREATE INDEX idx_end_port ON records(end_port);
CREATE INDEX idx_user_cabinet ON records(user_cabinet);
CREATE INDEX idx_operator ON records(operator);
CREATE INDEX idx_cable_type ON records(cable_type);
```

---

## 4. API接口设计

### 4.1 记录查询接口

#### 获取记录列表
- **接口：** `GET /api/records`
- **参数：**
  - `page`: 页码（默认1）
  - `pageSize`: 每页数量（默认50）
  - `datacenterNames`: 机房名称数组（可选）
  - `keyword`: 关键字（可选）
  - `cableType`: 线缆类型（可选）
  - `operator`: 运营商（可选）
  - `labelComplete`: 标签齐全（可选）
  - `cableStandard`: 线路规范（可选）
- **返回：**
```json
{
  "success": true,
  "data": {
    "records": [
      {
        "id": 1,
        "recordNumber": "WL-001",
        "datacenterName": "临港机房",
        "userUnit": "东方有线",
        "circuitNumber": "4705764620ShH",
        "startPort": "丽正路老芦公路光交",
        "endPort": "101机房G01"
      }
    ],
    "total": 156,
    "page": 1,
    "pageSize": 50
  }
}
```

#### 获取记录详情
- **接口：** `GET /api/records/:id`
- **参数：**
  - `id`: 记录ID
- **返回：**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "recordNumber": "WL-001",
    "datacenterName": "临港机房",
    "idcRequirementNumber": "RWD-20250805-065",
    "yesTicketNumber": "QTJF-202508-2354",
    "userUnit": "东方有线",
    "cableType": "单模光纤",
    "operator": "OCN",
    "circuitNumber": "4705764620ShH",
    "contactPerson": "400-884-1883",
    "startPort": "丽正路老芦公路光交",
    "hop1": "接入间A-A01-ODF3-1/2",
    "hop2": "接入间A-A04-ODF3-1#1/2",
    "hop3": "-",
    "hop4": "-",
    "hop5": "-",
    "endPort": "101机房G01",
    "userCabinet": "-",
    "labelComplete": 1,
    "cableStandard": 1,
    "remark": "-",
    "createdAt": "2025-12-24 10:30:00"
  }
}
```

---

### 4.2 文件上传接口

#### 上传文件
- **接口：** `POST /api/upload`
- **参数：**
  - `file`: Excel文件
- **返回：**
```json
{
  "success": true,
  "data": {
    "fileId": "1234567890",
    "fileName": "临港机房布线记录.xlsx",
    "recordCount": 25
  }
}
```

---

### 4.3 文件解析接口

#### 解析文件
- **接口：** `POST /api/parse`
- **参数：**
```json
{
  "fileId": "1234567890"
}
```
- **返回：**
```json
{
  "success": true,
  "data": {
    "records": [
      {
        "datacenterName": "临港机房",
        "userUnit": "东方有线",
        "circuitNumber": "4705764620",
        "startPort": "丽正路...",
        "endPort": "101机房"
      }
    ],
    "total": 25
  }
}
```

---

### 4.4 保存记录接口

#### 保存记录
- **接口：** `POST /api/records`
- **参数：**
```json
{
  "fileId": "1234567890",
  "records": [
    {
      "datacenterName": "临港机房",
      "userUnit": "东方有线",
      "circuitNumber": "4705764620",
      "startPort": "丽正路...",
      "endPort": "101机房"
    }
  ]
}
```
- **返回：**
```json
{
  "success": true,
  "data": {
    "savedCount": 25
  }
}
```

---

## 5. 前端路由设计

```typescript
const routes = [
  { path: '/', redirect: '/records' },
  { path: '/records', component: RecordList },
  { path: '/upload', component: UploadFile },
  { path: '/parse-result/:fileId', component: ParseResult },
  { path: '/record/:id', component: RecordDetail }
]
```

---

## 6. 前端组件设计

### 6.1 RecordList.vue
- 机房筛选组件
- 关键字查询组件
- 精确筛选组件
- 数据表格组件
- 分页组件

### 6.2 UploadFile.vue
- 文件上传组件
- 进度条组件

### 6.3 ParseResult.vue
- 解析结果表格组件
- 操作按钮组件

### 6.4 RecordDetail.vue
- 记录详情组件

---

## 7. 后端服务设计

### 7.1 record.service.ts
- 查询记录列表（支持多条件组合查询）
- 获取记录详情
- 保存记录
- 统计记录数量

### 7.2 upload.service.ts
- 上传文件
- 解析Excel文件
- 生成文件ID

---

## 8. 数据字典

### 8.1 机房列表
- 临港机房
- 金桥机房
- 国定机房
- 唐镇机房
- 美盛机房
- 通联机房
- 深圳云引擎机房

### 8.2 线缆类型
- 单模光纤
- 多模光纤
- 网线

### 8.3 运营商
- OCN
- 电信
- 移动
- 联通

---

## 9. 开发流程

### 9.1 后端开发
1. 初始化Node.js项目
2. 安装依赖
3. 创建数据库表
4. 实现数据模型
5. 实现业务逻辑
6. 实现API接口
7. 测试API

### 9.2 前端开发
1. 初始化Vue项目
2. 安装依赖
3. 创建组件
4. 实现路由
5. 实现API调用
6. 实现界面
7. 测试功能

---

## 10. 部署说明

### 10.1 本地开发
1. 启动后端服务：`cd backend && npm run dev`
2. 启动前端服务：`cd frontend && npm run dev`
3. 访问：`http://localhost:5173`

### 10.2 生产部署
1. 构建前端：`cd frontend && npm run build`
2. 配置后端静态文件服务
3. 启动后端服务：`cd backend && npm start`

---

## 11. 备注

- 系统设计遵循简洁、实用的原则
- 支持多机房数据统一管理和查询
- 查询功能是核心，支持灵活的查询条件组合
- 数据库使用SQLite，适合单用户、小规模数据
- 前后端分离开发，便于维护和扩展
