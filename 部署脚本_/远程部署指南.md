# 远程部署使用指南

## 📋 部署信息

- **服务器IP：** 192.168.19.58
- **用户名：** yroot
- **密码：** Yovole@2026
- **远程目录：** ~/sjzx-zonghebuxian

---

## 🚀 快速开始

### 方法1：使用自动部署脚本（推荐）

**步骤1：** 打开PowerShell，进入部署脚本目录
```powershell
cd "d:\TREA\sjzx-zonghebuxian\部署脚本_"
```

**步骤2：** 运行自动部署脚本
```powershell
.\远程部署_自动.ps1
```

**说明：**
- 脚本会自动完成所有部署步骤
- 需要输入密码：**Yovole@2026**
- 预计时间：20-40分钟

---

### 方法2：使用基础部署脚本

**步骤1：** 打开PowerShell，进入部署脚本目录
```powershell
cd "d:\TREA\sjzx-zonghebuxian\部署脚本_"
```

**步骤2：** 运行基础部署脚本
```powershell
.\远程部署.ps1
```

**说明：**
- 需要SSH密钥认证
- 如果没有SSH密钥，需要先设置
- 预计时间：20-40分钟

---

## 📋 部署步骤详解

### 步骤1：测试SSH连接

脚本会自动测试SSH连接是否正常。

**如果失败：**
- 检查网络连接
- 确认服务器IP地址：192.168.19.58
- 确认用户名和密码：yroot / Yovole@2026
- 检查SSH服务是否运行

---

### 步骤2：获取操作系统信息

脚本会自动检测远程服务器的操作系统类型和版本。

**支持的系统：**
- Ubuntu 20.04+
- Debian 10+
- CentOS 7+
- RHEL 7+
- Fedora 30+

---

### 步骤3：检查Node.js安装

脚本会自动检查Node.js是否已安装。

**如果未安装：**
- 脚本会自动安装Node.js 18
- 支持Ubuntu/Debian/CentOS/RHEL/Fedora

**如果版本过低：**
- 脚本会提示升级Node.js

---

### 步骤4：拷贝文件到远程服务器

脚本会自动拷贝以下文件到远程服务器：
- **backend/** - 后端代码
- **frontend/** - 前端代码
- **config/** - 配置文件

**预计时间：** 10-20分钟

**如果失败：**
- 检查密码是否正确
- 检查网络连接
- 检查远程服务器磁盘空间

---

### 步骤5：安装依赖

脚本会自动安装项目依赖：
- **后端依赖：** npm install --production
- **前端依赖：** npm install

**预计时间：** 5-10分钟

**如果失败：**
- 检查Node.js版本
- 检查npm配置
- 检查网络连接

---

### 步骤6：构建前端

脚本会自动构建前端项目：
- **命令：** npm run build

**预计时间：** 5-10分钟

**如果失败：**
- 检查前端代码
- 检查依赖安装
- 查看构建日志

---

### 步骤7：启动服务

脚本会自动启动前后端服务：
- **后端服务：** npm start
- **前端服务：** npm run preview

**预计时间：** 1-2分钟

**如果失败：**
- 检查端口是否被占用
- 检查日志文件
- 查看进程状态

---

### 步骤8：验证服务

脚本会自动验证服务是否正常运行：
- 检查进程是否运行
- 检查端口是否监听
- 检查服务是否可访问

---

## ✅ 部署完成后

### 访问应用

在浏览器中打开以下地址：
- **前端：** http://192.168.19.58:80
- **后端：** http://192.168.19.58:3001

### 查看日志

**查看后端日志：**
```bash
ssh yroot@192.168.19.58 'tail -f ~/sjzx-zonghebuxian/backend/backend.log'
```

**查看前端日志：**
```bash
ssh yroot@192.168.19.58 'tail -f ~/sjzx-zonghebuxian/frontend/frontend.log'
```

### 停止服务

**停止所有服务：**
```bash
ssh yroot@192.168.19.58 'pkill -f node'
```

**停止后端服务：**
```bash
ssh yroot@192.168.19.58 'pkill -f "node.*backend/server.js"'
```

**停止前端服务：**
```bash
ssh yroot@192.168.19.58 'pkill -f "npm.*preview"'
```

### 重启服务

**重启后端服务：**
```bash
ssh yroot@192.168.19.58 'cd ~/sjzx-zonghebuxian/backend && pkill -f "node.*backend/server.js" ; nohup npm start > backend.log 2>&1 &'
```

**重启前端服务：**
```bash
ssh yroot@192.168.19.58 'cd ~/sjzx-zonghebuxian/frontend && pkill -f "npm.*preview" ; nohup npm run preview > frontend.log 2>&1 &'
```

---

## 🆘 常见问题

### 问题1：SSH连接失败

**错误信息：**
```
SSH connection failed
```

**解决方法：**
1. 检查网络连接
2. 确认服务器IP地址：192.168.19.58
3. 确认用户名和密码：yroot / Yovole@2026
4. 检查SSH服务是否运行：`ssh yroot@192.168.19.58`

---

### 问题2：文件拷贝失败

**错误信息：**
```
Failed to copy backend files
Failed to copy frontend files
```

**解决方法：**
1. 检查密码是否正确
2. 检查网络连接
3. 检查远程服务器磁盘空间
4. 检查本地文件是否存在

---

### 问题3：依赖安装失败

**错误信息：**
```
Failed to install backend dependencies
Failed to install frontend dependencies
```

**解决方法：**
1. 检查Node.js版本（需要18+）
2. 检查npm配置
3. 检查网络连接
4. 手动安装依赖：`npm install`

---

### 问题4：前端构建失败

**错误信息：**
```
Failed to build frontend
```

**解决方法：**
1. 检查前端代码
2. 检查依赖安装
3. 查看构建日志
4. 手动构建：`npm run build`

---

### 问题5：服务启动失败

**错误信息：**
```
Failed to start backend service
Failed to start frontend service
```

**解决方法：**
1. 检查端口是否被占用
2. 检查日志文件
3. 查看进程状态
4. 手动启动服务

---

### 问题6：服务无法访问

**错误信息：**
```
Backend port 3001 is not listening
Frontend port 80 is not listening
```

**解决方法：**
1. 检查防火墙设置
2. 检查端口是否被占用
3. 检查服务是否启动
4. 查看服务日志

---

## 🔧 高级配置

### 修改服务器配置

编辑脚本中的配置变量：
```powershell
$REMOTE_HOST = "192.168.19.58"      # 服务器IP
$REMOTE_USER = "yroot"               # 用户名
$REMOTE_PASSWORD = "Yovole@2026"      # 密码
$REMOTE_DIR = "~/sjzx-zonghebuxian"  # 远程目录
```

### 修改端口配置

编辑远程服务器上的配置文件：
```bash
ssh yroot@192.168.19.58 'vi ~/sjzx-zonghebuxian/backend/config.js'
```

修改端口后重启服务：
```bash
ssh yroot@192.168.19.58 'pkill -f node'
```

---

## 📚 相关文档

- [远程服务器部署完整指南.md](file:///d:/TREA/sjzx-zonghebuxian/部署脚本_/远程服务器部署完整指南.md)
- [SSH密钥设置指南.md](file:///d:/TREA/sjzx-zonghebuxian/部署脚本_/SSH密钥设置指南.md)

---

## 🎯 开始部署！

准备好了吗？选择一个方法开始部署：

1. **推荐：** 运行 `.\远程部署_自动.ps1`（自动完成所有步骤）
2. **基础：** 运行 `.\远程部署.ps1`（需要SSH密钥）

如果在任何步骤遇到问题，告诉我：
1. 你执行到哪一步了
2. 看到什么错误信息
3. 我会立即帮你解决！😊
