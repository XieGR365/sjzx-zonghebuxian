# 服务器部署脚本使用说明

## 概述

本目录包含用于部署线缆管理系统的脚本，包括环境检查、安装和启动服务等功能。

## 脚本文件

### 1. 服务器安装.sh
- **用途**: 检查远程服务器环境并安装必要的依赖（Node.js、NPM等）
- **运行环境**: Ubuntu 20.04+ 或其他Linux系统
- **用户**: yroot
- **功能**:
  - SSH连接检查
  - 操作系统信息检查
  - Node.js环境检查和安装（版本18+）
  - NPM环境检查和安装
  - 磁盘空间检查（至少2GB）
  - 端口使用检查（3001和80端口）

### 2. 服务器启动.sh
- **用途**: 安装依赖并启动前后端服务
- **运行环境**: Ubuntu 20.04+ 或其他Linux系统
- **用户**: yroot
- **功能**:
  - 检查远程服务器文件
  - 检查Node.js和NPM环境
  - 检查端口使用情况
  - 安装后端依赖
  - 安装前端依赖
  - 启动后端服务
  - 启动前端服务
  - 验证服务状态

### 3. 服务器安装.ps1
- **用途**: Windows PowerShell版本的环境检查和安装脚本
- **运行环境**: Windows PowerShell 5+
- **用户**: yroot

### 4. 服务器启动.ps1
- **用途**: Windows PowerShell版本的服务启动脚本
- **运行环境**: Windows PowerShell 5+
- **用户**: yroot

### 5. 1_拷贝文件到远程服务器.ps1
- **用途**: 将项目文件从本地复制到远程服务器
- **运行环境**: Windows PowerShell

## 使用步骤

### 在Linux系统上部署（推荐）

1. **设置SSH免密登录**（可选，但推荐）：
   ```bash
   ssh-copy-id yroot@192.168.19.58
   ```

2. **运行环境检查和安装脚本**：
   ```bash
   chmod +x 服务器安装.sh
   ./服务器安装.sh
   ```

3. **运行文件复制脚本**（在Windows上）：
   ```powershell
   cd "d:\TREA\sjzx-zonghebuxian\部署脚本_"
   .\1_拷贝文件到远程服务器.ps1
   ```

4. **运行服务启动脚本**：
   ```bash
   chmod +x 服务器启动.sh
   ./服务器启动.sh
   ```

### 在Windows系统上部署

1. **运行环境检查和安装脚本**：
   ```powershell
   cd "d:\TREA\sjzx-zonghebuxian\部署脚本_"
   .\服务器安装.ps1
   ```

2. **运行文件复制脚本**：
   ```powershell
   .\1_拷贝文件到远程服务器.ps1
   ```

3. **运行服务启动脚本**：
   ```powershell
   .\服务器启动.ps1
   ```

## 配置说明

### 修改服务器地址和用户名

如果需要修改服务器地址或用户名，请编辑脚本文件中的以下变量：

**Bash脚本**：
```bash
REMOTE_HOST="192.168.19.58"
REMOTE_USER="yroot"
```

**PowerShell脚本**：
```powershell
$REMOTE_HOST = "192.168.19.58"
$REMOTE_USER = "yroot"
```

## 访问服务

部署完成后，可以通过以下URL访问服务：

- **前端**: http://192.168.19.58:80
- **后端**: http://192.168.19.58:3001

## 查看日志

### 后端日志
```bash
ssh yroot@192.168.19.58 'tail -f ~/sjzx-zonghebuxian/backend/backend.log'
```

### 前端日志
```bash
ssh yroot@192.168.19.58 'tail -f ~/sjzx-zonghebuxian/frontend/frontend.log'
```

## 故障排查

### SSH连接失败
- 检查服务器IP地址是否正确
- 确认SSH服务是否运行
- 检查网络连接
- 确认SSH密钥或密码配置正确

### Node.js安装失败
- 检查网络连接
- 确认操作系统版本（需要Ubuntu 20.04+）
- 检查磁盘空间是否充足

### 服务启动失败
- 检查端口是否被占用
- 查看服务日志文件
- 确认依赖是否正确安装

## 注意事项

1. 脚本会逐步检查环境，如果发现问题会立即停止并提示
2. Node.js安装可能需要几分钟时间，请耐心等待
3. 前端构建可能需要较长时间，请耐心等待
4. 确保远程服务器有足够的磁盘空间（至少2GB）
5. 确保远程服务器的3001和80端口未被占用

## 系统要求

### 远程服务器
- 操作系统: Ubuntu 20.04+ 或其他Linux发行版
- 内存: 至少2GB
- 磁盘空间: 至少2GB可用空间
- 网络: 能够访问外网（用于下载Node.js和NPM包）

### 本地开发机
- Windows PowerShell 5+（如果使用PowerShell脚本）
- SSH客户端（通常Windows 10+已包含）
- SCP客户端（用于文件传输）

## 支持

如有问题，请查看日志文件或联系技术支持。
