# 综合布线记录管理系统 - 部署架构方案

## 1. 系统架构概述

### 1.1 技术栈
- **前端**: Vue 3 + TypeScript + Vite + Element Plus
- **后端**: Node.js + Express + TypeScript
- **数据库**: SQLite (better-sqlite3)
- **Web服务器**: IIS 或 Nginx
- **反向代理**: IIS 或 Nginx
- **HTTPS**: Let's Encrypt (免费SSL证书)

### 1.2 部署架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        客户端                                │
│  (浏览器/移动设备)                                           │
└──────────────────────┬──────────────────────────────────────┘
                       │ HTTPS (443端口)
                       │
┌──────────────────────▼──────────────────────────────────────┐
│              Windows Server (内部服务器/跳板机)              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  IIS / Nginx (反向代理 + HTTPS)                      │  │
│  │  - SSL/TLS加密                                        │  │
│  │  - 静态文件服务                                       │  │
│  │  - API请求转发                                        │  │
│  └──────────────┬───────────────────────────────────────┘  │
│                 │                                           │
│  ┌──────────────▼───────────────────────────────────────┐  │
│  │  Node.js 后端服务 (Express)                          │  │
│  │  - RESTful API                                       │  │
│  │  - 文件上传处理                                      │  │
│  │  - Excel解析                                        │  │
│  │  - 数据库操作                                        │  │
│  └──────────────┬───────────────────────────────────────┘  │
│                 │                                           │
│  ┌──────────────▼───────────────────────────────────────┐  │
│  │  SQLite 数据库                                       │  │
│  │  - 布线记录数据                                      │  │
│  │  - 查询条件数据                                      │  │
│  │  - 统计数据                                          │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  监控与运维工具                                      │  │
│  │  - PM2 (进程管理)                                    │  │
│  │  - WinSW (Windows服务)                               │  │
│  │  - 定时任务 (数据备份)                               │  │
│  │  - 日志管理                                          │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                       │
                       │ VPN / 公网IP
                       │
┌──────────────────────▼──────────────────────────────────────┐
│                    远程用户                                 │
│  (通过VPN或公网IP访问)                                      │
└─────────────────────────────────────────────────────────────┘
```

## 2. 部署方案设计

### 2.1 方案特点
- **低成本**: 使用免费SSL证书 (Let's Encrypt)
- **高安全性**: HTTPS加密传输 + 数据库加密
- **易维护**: 自动化备份 + 监控告警
- **高可用**: 进程守护 + 自动重启
- **小规模优化**: 针对1-10人用户优化资源配置

### 2.2 端口规划
| 服务 | 端口 | 说明 |
|------|------|------|
| HTTPS | 443 | 安全访问端口 |
| HTTP | 80 | 自动重定向到HTTPS |
| 后端API | 3001 | 内部端口，不直接暴露 |
| 数据库 | 文件 | SQLite文件存储 |

### 2.3 目录结构
```
D:\wiring-record-system\
├── frontend\              # 前端静态文件
├── backend\               # 后端服务
│   ├── dist\             # 编译后的代码
│   ├── uploads\          # 上传文件目录
│   ├── logs\             # 日志目录
│   └── database\         # 数据库文件
├── ssl\                  # SSL证书
├── backup\               # 数据备份目录
└── monitoring\           # 监控脚本
```

### 2.4 安全措施
1. **传输安全**
   - HTTPS加密 (TLS 1.2+)
   - 强制HTTPS访问
   - HSTS头设置

2. **数据安全**
   - SQLite数据库加密
   - 定期数据备份
   - 敏感信息不记录日志

3. **访问控制**
   - IP白名单 (可选)
   - 请求频率限制
   - 文件上传大小限制

4. **系统安全**
   - 定期更新依赖包
   - Windows安全更新
   - 防火墙配置

## 3. 部署环境要求

### 3.1 服务器配置
- **操作系统**: Windows Server 2016+ 或 Windows 10/11
- **CPU**: 2核及以上
- **内存**: 4GB及以上
- **磁盘**: 20GB及以上可用空间
- **网络**: 公网IP或VPN访问

### 3.2 软件环境
- **Node.js**: 18.0.0+ (LTS版本)
- **npm**: 9.0.0+
- **IIS**: 8.0+ 或 Nginx 1.18+
- **PowerShell**: 5.1+

### 3.3 网络要求
- 公网IP或VPN访问能力
- 开放端口: 80, 443
- 域名 (可选，用于SSL证书)

## 4. 部署流程

### 4.1 部署步骤概览
1. 环境准备 (Node.js, IIS/Nginx)
2. 前端构建与部署
3. 后端构建与部署
4. 数据库初始化
5. HTTPS配置
6. 服务配置 (Windows服务)
7. 监控与备份配置
8. 测试验证

### 4.2 预计部署时间
- 环境准备: 30分钟
- 前后端部署: 30分钟
- HTTPS配置: 20分钟
- 监控备份配置: 30分钟
- 测试验证: 20分钟
- **总计**: 约2小时

## 5. 备份与恢复策略

### 5.1 备份策略
- **数据库备份**: 每日自动备份
- **上传文件备份**: 每周自动备份
- **配置文件备份**: 每次修改后手动备份
- **备份保留**: 保留最近30天

### 5.2 恢复策略
- 数据库恢复: 从备份文件恢复
- 文件恢复: 从备份目录恢复
- 服务恢复: Windows服务自动重启

## 6. 监控与告警

### 6.1 监控指标
- CPU使用率
- 内存使用率
- 磁盘使用率
- 服务运行状态
- 日志错误统计

### 6.2 告警方式
- 邮件告警
- 日志记录
- 系统事件日志

## 7. 运维建议

### 7.1 日常运维
- 每日检查服务运行状态
- 每周检查磁盘空间
- 每月检查日志文件
- 定期更新依赖包

### 7.2 故障处理
- 查看日志文件定位问题
- 重启服务尝试恢复
- 从备份恢复数据
- 联系技术支持

## 8. 成本估算

### 8.1 软件成本
- Windows Server: 已有服务器 (0元)
- Node.js: 免费 (0元)
- IIS/Nginx: 免费 (0元)
- SSL证书: 免费 (0元)
- **总计**: 0元

### 8.2 硬件成本
- 服务器: 已有服务器 (0元)
- **总计**: 0元

### 8.3 人力成本
- 部署: 2小时
- 日常维护: 每周1小时
- **总计**: 低成本

## 9. 扩展性考虑

### 9.1 水平扩展
- 可增加服务器节点
- 使用负载均衡
- 数据库迁移到MySQL/PostgreSQL

### 9.2 垂直扩展
- 增加服务器配置
- 优化数据库查询
- 使用缓存

## 10. 风险评估

### 10.1 潜在风险
- 服务器宕机
- 数据丢失
- 网络攻击
- 系统漏洞

### 10.2 风险应对
- 定期备份
- 安全加固
- 监控告警
- 及时更新

---

**文档版本**: v1.0
**创建日期**: 2025-12-30
**最后更新**: 2025-12-30
**维护人员**: 综合布线记录管理系统团队
