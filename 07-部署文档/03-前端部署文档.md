# 前端部署文档

## 1. 前端概述

### 1.1 技术栈
- **框架**: Vue 3
- **语言**: TypeScript
- **构建工具**: Vite
- **UI组件库**: Element Plus
- **路由**: Vue Router
- **状态管理**: Pinia

### 1.2 部署目标
- 将Vue 3应用构建为静态文件
- 部署到IIS静态文件服务
- 配置反向代理到后端API

## 2. 准备工作

### 2.1 确认源码位置
确保前端源码位于:
```
d:\TREA\sjzx-zonghebuxian\04-实施\前端\
```

### 2.2 检查依赖文件
确认以下文件存在:
- package.json
- vite.config.ts
- tsconfig.json
- index.html

## 3. 构建前端应用

### 3.1 安装依赖
```powershell
cd d:\TREA\sjzx-zonghebuxian\04-实施\前端
npm install
```

### 3.2 配置生产环境

#### 3.2.1 修改API地址
编辑 `src\utils\request.ts` 或相关配置文件，将API地址修改为生产环境地址:

```typescript
const baseURL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:3001/api';
```

#### 3.2.2 创建生产环境配置
创建 `.env.production` 文件:

```env
VITE_API_BASE_URL=/api
```

### 3.3 执行构建
```powershell
npm run build
```

构建成功后，会在 `dist` 目录生成静态文件。

### 3.4 验证构建结果
```powershell
Get-ChildItem -Path "dist" -Recurse
```

预期输出:
```
    目录: d:\TREA\sjzx-zonghebuxian\04-实施\前端\dist

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d----          2025/12/30    10:00                assets
-a---          2025/12/30    10:00           1234 index.html
```

## 4. 部署到IIS

### 4.1 复制构建文件
```powershell
Copy-Item -Path "d:\TREA\sjzx-zonghebuxian\04-实施\前端\dist\*" -Destination "D:\wiring-record-system\frontend\" -Recurse -Force
```

### 4.2 创建IIS站点

#### 4.2.1 打开IIS管理器
1. 按 `Win + R`，输入 `inetmgr`，回车
2. 打开IIS管理器

#### 4.2.2 添加网站
1. 右键点击"网站"，选择"添加网站"
2. 填写以下信息:
   - 网站名称: `WiringRecordSystem`
   - 物理路径: `D:\wiring-record-system\frontend`
   - 端口: `80`
   - 主机名: (留空或填写域名)
3. 点击"确定"

### 4.3 配置URL重写规则

#### 4.3.1 创建web.config文件
在 `D:\wiring-record-system\frontend\` 目录创建 `web.config` 文件:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <system.webServer>
    <rewrite>
      <rules>
        <rule name="Handle History Mode and custom 404/500" stopProcessing="true">
          <match url="(.*)" />
          <conditions logicalGrouping="MatchAll">
            <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
            <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
          </conditions>
          <action type="Rewrite" url="/" />
        </rule>
        <rule name="ReverseProxyInboundRule1" stopProcessing="true">
          <match url="^api/(.*)" />
          <action type="Rewrite" url="http://localhost:3001/api/{R:1}" />
        </rule>
      </rules>
    </rewrite>
    <httpProtocol>
      <customHeaders>
        <add name="X-Content-Type-Options" value="nosniff" />
        <add name="X-Frame-Options" value="DENY" />
        <add name="X-XSS-Protection" value="1; mode=block" />
      </customHeaders>
    </httpProtocol>
    <staticContent>
      <mimeMap fileExtension=".json" mimeType="application/json" />
      <mimeMap fileExtension=".woff" mimeType="application/font-woff" />
      <mimeMap fileExtension=".woff2" mimeType="application/font-woff2" />
    </staticContent>
  </system.webServer>
</configuration>
```

#### 4.3.2 启用URL重写
1. 在IIS管理器中，选择刚创建的网站
2. 双击"URL重写"
3. 确认规则已正确配置

### 4.4 配置MIME类型
1. 在IIS管理器中，选择网站
2. 双击"MIME类型"
3. 确认以下类型已配置:
   - .json: application/json
   - .woff: application/font-woff
   - .woff2: application/font-woff2

## 5. 验证部署

### 5.1 本地访问测试
在浏览器中访问:
```
http://localhost
```

预期结果: 看到综合布线记录管理系统首页

### 5.2 检查控制台
1. 打开浏览器开发者工具 (F12)
2. 查看Console标签
3. 确认没有错误信息

### 5.3 检查网络请求
1. 打开浏览器开发者工具 (F12)
2. 切换到Network标签
3. 刷新页面
4. 确认API请求正常

## 6. 性能优化

### 6.1 启用压缩
在 `web.config` 中添加压缩配置:

```xml
<urlCompression doStaticCompression="true" doDynamicCompression="true" />
```

### 6.2 设置缓存策略
在 `web.config` 中添加缓存配置:

```xml
<staticContent>
  <clientCache cacheControlMode="UseMaxAge" cacheControlMaxAge="365.00:00:00" />
</staticContent>
```

### 6.3 启用HTTP/2
1. 在IIS管理器中，选择网站
2. 双击"HTTP响应头"
3. 添加自定义头:
   - 名称: `Keep-Alive`
   - 值: `timeout=5, max=100`

## 7. 安全配置

### 7.1 设置安全头
在 `web.config` 中添加安全头:

```xml
<httpProtocol>
  <customHeaders>
    <add name="Strict-Transport-Security" value="max-age=31536000; includeSubDomains" />
    <add name="X-Content-Type-Options" value="nosniff" />
    <add name="X-Frame-Options" value="DENY" />
    <add name="X-XSS-Protection" value="1; mode=block" />
    <add name="Content-Security-Policy" value="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:;" />
  </customHeaders>
</httpProtocol>
```

### 7.2 禁用目录浏览
1. 在IIS管理器中，选择网站
2. 双击"目录浏览"
3. 点击"禁用"

### 7.3 禁用详细错误信息
1. 在IIS管理器中，选择网站
2. 双击"错误页"
3. 点击"编辑功能设置"
4. 选择"详细错误"或"自定义错误页"

## 8. 故障排查

### 8.1 页面无法访问
**问题**: 访问网站时显示404或500错误

**解决方案**:
1. 检查IIS网站是否运行
2. 检查物理路径是否正确
3. 检查端口是否被占用
4. 查看IIS日志文件

### 8.2 API请求失败
**问题**: 前端无法访问后端API

**解决方案**:
1. 检查后端服务是否运行
2. 检查反向代理规则是否正确
3. 检查CORS配置
4. 查看浏览器控制台错误信息

### 8.3 静态资源404
**问题**: CSS、JS等静态资源无法加载

**解决方案**:
1. 检查文件是否正确复制
2. 检查MIME类型配置
3. 检查文件路径是否正确

### 8.4 路由刷新404
**问题**: 刷新页面时显示404错误

**解决方案**:
1. 检查URL重写规则是否正确配置
2. 确认Vue Router使用history模式

## 9. 更新部署

### 9.1 更新流程
1. 在开发环境执行构建:
```powershell
cd d:\TREA\sjzx-zonghebuxian\04-实施\前端
npm run build
```

2. 备份当前版本:
```powershell
Copy-Item -Path "D:\wiring-record-system\frontend" -Destination "D:\wiring-record-system\backup\frontend_$(Get-Date -Format 'yyyyMMdd_HHmmss')" -Recurse
```

3. 部署新版本:
```powershell
Copy-Item -Path "d:\TREA\sjzx-zonghebuxian\04-实施\前端\dist\*" -Destination "D:\wiring-record-system\frontend\" -Recurse -Force
```

4. 清除浏览器缓存
5. 验证新版本

### 9.2 回滚操作
如果新版本有问题，可以回滚到备份版本:

```powershell
# 停止IIS网站
Stop-Website -Name "WiringRecordSystem"

# 恢复备份
$backupDir = Get-ChildItem -Path "D:\wiring-record-system\backup" -Directory | Sort-Object LastWriteTime -Descending | Select-Object -First 1
Remove-Item -Path "D:\wiring-record-system\frontend\*" -Recurse -Force
Copy-Item -Path "$($backupDir.FullName)\*" -Destination "D:\wiring-record-system\frontend\" -Recurse -Force

# 启动IIS网站
Start-Website -Name "WiringRecordSystem"
```

## 10. 监控与日志

### 10.1 查看IIS日志
IIS日志默认位置:
```
C:\inetpub\logs\LogFiles\W3SVC1\
```

### 10.2 监控网站状态
```powershell
# 检查网站状态
Get-Website -Name "WiringRecordSystem"

# 检查应用程序池
Get-WebAppPoolState -Name "WiringRecordSystem"
```

## 11. 下一步

前端部署完成后，请继续阅读:
- [03-后端部署文档.md](./03-后端部署文档.md)
- [04-HTTPS配置文档.md](./04-HTTPS配置文档.md)

---

**文档版本**: v1.0
**创建日期**: 2025-12-30
**最后更新**: 2025-12-30
**维护人员**: 综合布线记录管理系统团队
